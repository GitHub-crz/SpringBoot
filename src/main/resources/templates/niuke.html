<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<p> 【得分点】 </p> <p>     五种常用数据类型 </p> <p> 【参考答案】 </p> <p> 标准回答 </p> <p>     它主要提供了5种数据类型：字符串(string)、哈希(hash)、列表(list)、集合(set)、有序集合(zset)。Redis还提供了Bitmap、HyperLogLog、Geo类型，但这些类型都是基于上述核心数据类型实现的。5.0版本中，Redis新增加了Streams数据类型，它是一个功能强大的、支持多播的、可持久化的消息队列。 </p> <p> 1. string可以存储字符串、数字和二进制数据，除了值可以是String以外，所有的键也可以是string，string最大可以存储大小为512M的数据。 </p> <p> 2. list保证数据线性有序且元素可重复，它支持lpush、blpush、rpop、brpop等操作，可以当作简单的消息队列使用，一个list最多可以存储2^32-1个元素。 </p> <p> 3. hash的值本身也是一个键值对结构，最多能存储2^32-1个元素。 </p> <p> 4. set是无序不可重复的，它支持多个set求交集、并集、差集，适合实现共同关注之类的需求，一个set最多可以存储2^32-1个元素。 </p> <p> 5. zset是有序不可重复的，它通过给每个元素设置一个分数来作为排序的依据，一个zset最多可以存储2^32-1个元素。 </p> <p> 加分回答 </p> <p>     每种类型支持多个编码，每一种编码采取一个特殊的结构来实现，各类数据结构内部的编码及结构： </p> <p> 1. string：编码分为int、raw、embstr。int底层实现为long，当数据为整数型并且可以用long类型表示时可以用long存储。embstr底层实现为占一块内存的SDS结构，当数据为长度不超过32字节的字符串时，选择以此结构连续存储元数据和值。raw底层实现为占两块内存的SDS，用于存储长度超过32字节的字符串数据，此时会在两块内存中分别存储元数据和值。 </p> <p> 2. list：编码分为ziplist、linkedlist、quicklist（3.2以前版本没有quicklist）。ziplist底层实现为压缩列表，当元素数量小于512且所有元素长度都小于64字节时，使用这种结构来存储。linkedlist底层实现为双端链表，当数据不符合ziplist条件时，使用这种结构存储。3.2版本之后list采用quicklist的快速列表结构来代替前两种。 </p> <p> 3. hash：编码分为ziplist、hashtable两种。其中ziplist底层实现为压缩列表，当键值对数量小于512，并且所有的键值长度都小于64字节时使用这种结构进行存储。hashtable底层实现为字典，当不符合压缩列表存储条件时，使用字典进行存储。 </p> <p> 4. set：编码分为inset、hashtable。intset底层实现为整数集合，当所有元素都是整数值且数量不超过512个时使用该结构存储，否则使用字典结构存储。 </p> <p> 5. zset：编码分为ziplist、skiplist。当元素数量小于128，并且每个元素长度都小于64字节时，使用ziplist压缩列表结构存储，否则使用skiplist的字典+跳表的结构存储。 </p> <p> 【延伸阅读】 </p> <table cellpadding="0" cellspacing="0"> <tbody> <tr> <td> </td> </tr> <tr> <td> </td> <td> </td> </tr> </tbody> </table> <div>     Redis没有直接使用C语言传统的字符串表示，而是自己构建了一种名为简单动态字符串（Simple Dynamic String），即SDS的抽象类型，并将SDS用作Redis的默认字符串表示。每个sds.h/sdshdr结构表示一个SDS值，它有三个属性，这里我们举个例子： </div> <div> <img alt="" src="https://uploadfiles.nowcoder.com/images/20210901/308571_1630485747078/30C0BEB277B871827D7D943F3B4B2F47"><br> </div> <div> <p> · free属性值为0，代表这个SDS没有被分配任何未使用空间； </p> <p> · len属性值为5，代表这个SDS存了一个五字节长的字符串； </p> <p> · buf属性是一个char类型的数组，数组的前五个字节分别保存了‘H’、‘e’、‘l’、‘l’、‘o’ 五个字符，而最后一个字节则保存了空字符‘\0’。 </p> <p>     SDS遵循C字符串以空字符结尾的惯例，保存空字符的一字节空间不计算在SDS的len属性中。为空字符串分配1字节的额外空间以及添加空字符到字符串末尾等操作都是由SDS函数自动完成的，所以这个空字符串对于SDS的使用者来说完全透明。遵循空字符串的好处是，SDS可以直接重用一部分C字符串函数库里的函数。 </p> <br> </div>
</body>
</html>